---
layout: default
title: Finder
---

<div class="max-w-7xl mx-auto px-6 py-10 space-y-12">

    <div class="text-center space-y-4">
        <h1 class="text-4xl md:text-6xl font-extrabold text-white tracking-tight">
            Melyik <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-fuchsia-500">környezet</span> való neked?
        </h1>
        <p class="text-lg text-gray-400 max-w-2xl mx-auto">
            Valós idejű összehasonlítás Arch Linux alapokon.
            <br>Válassz szűrőket a diagramok és a táblázat frissítéséhez!
        </p>
    </div>

    <div class="grid gap-6 md:grid-cols-3">
        <div class="bg-darkbg-800 border border-darkbg-700 rounded-2xl p-6 shadow-xl relative overflow-hidden group hover:border-fuchsia-500/30 transition-colors">
            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-fuchsia-500"></span> RAM (Idle MB)
            </h3>
            <div class="h-48 w-full">
                <canvas id="chartRam"></canvas>
            </div>
        </div>
        <div class="bg-darkbg-800 border border-darkbg-700 rounded-2xl p-6 shadow-xl relative overflow-hidden group hover:border-cyan-500/30 transition-colors">
            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-cyan-500"></span> CPU Index
            </h3>
            <div class="h-48 w-full">
                <canvas id="chartCpu"></canvas>
            </div>
        </div>
        <div class="bg-darkbg-800 border border-darkbg-700 rounded-2xl p-6 shadow-xl relative overflow-hidden group hover:border-lime-500/30 transition-colors">
            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-lime-500"></span> Méret (MB)
            </h3>
            <div class="h-48 w-full">
                <canvas id="chartDisk"></canvas>
            </div>
        </div>
    </div>

    <div class="flex flex-col items-center gap-4">
        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-widest">Szűrés tulajdonságok szerint</h3>
        
        <div class="flex flex-wrap justify-center gap-3">
            {% for filter in site.data.environments.feature_filters %}
            <button 
                onclick="toggleColFilter('{{ filter.id }}')" 
                id="col-btn-{{ filter.id }}"
                class="col-filter-btn px-5 py-2 rounded-full text-sm font-bold border border-darkbg-700 bg-darkbg-800 text-gray-400 transition-all duration-300 hover:border-cyan-500/50 hover:text-white hover:shadow-[0_0_15px_rgba(6,182,212,0.3)] shadow-sm"
                data-filter-id="{{ filter.id }}">
                {{ filter.name }}
            </button>
            {% endfor %}
            
            <button onclick="clearAllFilters()" id="reset-btn" class="hidden px-5 py-2 rounded-full text-sm font-bold border border-red-900/50 bg-red-900/10 text-red-400 hover:bg-red-900/30 transition-all">
                ✕ Törlés
            </button>
        </div>
    </div>

    <div class="bg-darkbg-800 rounded-2xl shadow-2xl border border-darkbg-700 overflow-hidden relative">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead class="bg-darkbg-900/50">
                    <tr class="border-b border-darkbg-700">
                        {% for header in site.data.environments.headers %}
                            <th class="p-5 whitespace-nowrap text-xs font-bold text-gray-400 uppercase tracking-wider col-cell col-{{ header.key }} 
                                {% if header.key == 'feature' %}sticky left-0 bg-darkbg-800 z-20 border-r border-darkbg-700{% endif %}"
                                data-key="{{ header.key }}"
                                data-tags="{{ header.tags | join: ',' }}">
                                {{ header.name }}
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="divide-y divide-darkbg-700/50">
                    {% for row in site.data.environments.rows %}
                    <tr class="hover:bg-white/5 transition-colors table-row-item">
                        {% for header in site.data.environments.headers %}
                            {% if header.key == 'feature' %}
                                <td class="p-5 font-semibold text-white sticky left-0 bg-darkbg-800 z-10 border-r border-darkbg-700 shadow-[2px_0_5px_rgba(0,0,0,0.2)]">
                                    {{ row.feature }}
                                </td>
                            {% else %}
                                <td class="p-5 text-gray-400 col-cell col-{{ header.key }}">
                                    {{ row[header.key] }}
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div id="no-results" class="hidden p-12 text-center text-gray-500">
            Nincs találat a kiválasztott feltételekre.
        </div>
    </div>

</div>

<script>
    // --- 1. ADATOK + SZÍNEK BETÖLTÉSE ---
    const envData = [
        {% for header in site.data.environments.headers %}
        {% if header.key != 'feature' %}
        {
            key: "{{ header.key }}",
            name: "{{ header.name }}",
            color: "{{ header.color }}", // Kinyerjük a hex kódot (pl. #3b82f6)
            ram: {{ header.metrics.ram }},
            cpu: {{ header.metrics.cpu }},
            disk: {{ header.metrics.disk }}
        },
        {% endif %}
        {% endfor %}
    ];

    // --- 2. CHART.JS CONFIG ---
    Chart.defaults.font.family = 'Inter';
    Chart.defaults.color = '#9ca3af';
    Chart.defaults.borderColor = '#374151';
    
    let chartRam, chartCpu, chartDisk;

    function initCharts() {
        const commonOptions = {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: '#334155' } },
                x: { grid: { display: false }, ticks: { display: false } }
            },
            animation: { duration: 500 }
        };

        const createChart = (id) => new Chart(document.getElementById(id), {
            type: 'bar',
            data: { 
                labels: [], 
                datasets: [{ 
                    data: [], 
                    backgroundColor: [], // Dinamikus színek
                    borderRadius: 6,
                    borderSkipped: false 
                }] 
            }, 
            options: commonOptions
        });

        chartRam = createChart('chartRam');
        chartCpu = createChart('chartCpu');
        chartDisk = createChart('chartDisk');
    }

    // --- 3. SZŰRÉS LOGIKA + BUBORÉK STÍLUS ---
    // A "Neon" stílus osztályai az aktív gombokhoz
    const activeBtnClasses = ['bg-cyan-500', 'text-black', 'border-cyan-400', 'shadow-[0_0_15px_rgba(6,182,212,0.6)]'];
    const inactiveBtnClasses = ['bg-darkbg-800', 'text-gray-400', 'border-darkbg-700'];

    let selectedColFilters = new Set(); 

    document.addEventListener("DOMContentLoaded", () => {
        initCharts();
        updateView();
    });

    function toggleColFilter(filterId) {
        const btn = document.getElementById(`col-btn-${filterId}`);
        
        if (selectedColFilters.has(filterId)) {
            // Deaktiválás
            selectedColFilters.delete(filterId);
            btn.classList.remove(...activeBtnClasses);
            btn.classList.add(...inactiveBtnClasses);
        } else {
            // Aktiválás (Színes Buborék!)
            selectedColFilters.add(filterId);
            btn.classList.remove(...inactiveBtnClasses);
            btn.classList.add(...activeBtnClasses);
        }
        updateView();
    }

    function clearAllFilters() {
        selectedColFilters.clear();
        // Minden gomb visszaállítása inaktívra
        document.querySelectorAll('.col-filter-btn').forEach(btn => {
            btn.classList.remove(...activeBtnClasses);
            btn.classList.add(...inactiveBtnClasses);
        });
        updateView();
    }

    function updateView() {
        // Reset gomb
        const resetBtn = document.getElementById('reset-btn');
        resetBtn.style.display = selectedColFilters.size > 0 ? 'block' : 'none';

        // Oszlopok szűrése
        const headers = document.querySelectorAll('th.col-cell:not(.sticky)');
        let visibleKeys = [];

        headers.forEach(th => {
            const key = th.getAttribute('data-key');
            const tags = th.getAttribute('data-tags').split(',');
            const matches = selectedColFilters.size === 0 || Array.from(selectedColFilters).every(filter => tags.includes(filter));
            
            const cells = document.querySelectorAll(`.col-${key}`);
            
            if (matches) {
                th.style.display = '';
                cells.forEach(cell => cell.style.display = '');
                visibleKeys.push(key);
            } else {
                th.style.display = 'none';
                cells.forEach(cell => cell.style.display = 'none');
            }
        });

        // Diagram frissítés (Színekkel együtt!)
        const filteredData = envData.filter(item => visibleKeys.includes(item.key));
        
        const labels = filteredData.map(d => d.name);
        const colors = filteredData.map(d => d.color); // Itt kapják meg a színt!

        updateChart(chartRam, labels, filteredData.map(d => d.ram), colors);
        updateChart(chartCpu, labels, filteredData.map(d => d.cpu), colors);
        updateChart(chartDisk, labels, filteredData.map(d => d.disk), colors);

        // Empty state
        const noResults = document.getElementById('no-results');
        const tableWrapper = document.querySelector('.overflow-x-auto');
        
        if (visibleKeys.length === 0) {
            noResults.classList.remove('hidden');
            tableWrapper.classList.add('hidden');
        } else {
            noResults.classList.add('hidden');
            tableWrapper.classList.remove('hidden');
        }
    }

    function updateChart(chart, labels, data, colors) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = data;
        chart.data.datasets[0].backgroundColor = colors; // Szín átadása a Chart.js-nek
        chart.update();
    }
</script>
